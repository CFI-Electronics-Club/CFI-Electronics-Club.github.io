<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Electronics Club, IIT Madras</title>
    <link rel="icon" href="../../../images/elec.png">
    <link rel="stylesheet" href="../../../css/articles_light.css" />
    <link rel="stylesheet" href="../../../css/articles.css" />
    <link rel="stylesheet" href="../../../css/checkbox.css" />
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.5/build/pure-min.css"
        integrity="sha384-LTIDeidl25h2dPxrB2Ekgc9c7sEC3CWGM6HeFmuDNUjX76Ert4Z4IY714dhZHPLd" crossorigin="anonymous">
    <link rel="stylesheet" href="../styles.css">

</head>

<body>

    <div id="layout">
        <!-- Menu toggle -->
        <div>
            <a href="#menu" id="menuLink" class="menu-link active">
                <!-- Hamburger icon -->
                <span></span>
            </a>
            <div style='position: fixed; right: 10px;'>
                <img src="https://img.icons8.com/doodle/48/000000/sun--v1.png" style="width:35px" />

                <label class="switch" style="top: -10px">
                    <input type="checkbox" id='checkbox' checked onclick="toggleTheme()">
                    <span class="slider round"></span>
                </label>
                <img src="https://img.icons8.com/plasticine/100/000000/crescent-moon.png" style="width:35px" />
            </div>
        </div>

        <div id="menu" style='font-family: "Archivo Black", "sans-serif"; background-color: #1a1a2e;'>
            <div class="pure-menu">
                <a class="pure-menu-heading"
                    style='padding: 20px 0; background-color: #1a1a2e; text-align: center; display: flex; align-items: center; font-family: "Archivo Black", sans-serif;text-decoration: none; '
                    href="../../../index.html">
                    <img src="../../../images/elec.png" alt="" style='width: 100px'>
                    Electronics <br> Club
                </a>

                <ul class="pure-menu-list">
                    <li class=""><a href="../Getting Started.html" class="pure-menu-link">Getting Started</a></li>
                    <ul class="pure-menu-list">
                        <label for="drop" class="toggle" style="padding-left: 10px;">Basics</label>
                        <input type="checkbox" id="drop" />
                        <ul class="pure-menu-item menu">
                            <li class="">
                                <a href="../Basics/Arduino Installation.html" style="padding-left:20px" class="pure-menu-link">Arduino Installation</a>
                            </li>
                            <li class="">
                                <a href="../Basics/Fundamentals.html" style="padding-left:20px" class="pure-menu-link">Fundamentals</a>
                            </li>
                            <li class="">
                                <a href="../Basics/Analog vs Digital.html" style="padding-left:20px" class="pure-menu-link">Analog vs Digital</a>
                            </li>
                            
                            <li class="">
                                <a href="../Basics/Pulse Width Modulation.html" style="padding-left:20px" class="pure-menu-link">Pulse Width Modulation</a>
                            </li>
                            <li class="">
                                <a href="../Basics/Push buttons.html" style="padding-left:20px" class="pure-menu-link">Push buttons</a>
                            </li>
                            <li class="">
                                <a href="../Basics/Capactive Touch Pins.html" style="padding-left:20px" class="pure-menu-link">Capactive Touch Pins</a>
                            </li>
                            <li class="">
                                <a href="../Basics/PullUp-Down Resistors.html" style="padding-left:20px" class="pure-menu-link">Pull Up/Down Resistors</a>
                            </li><li class="">
                                <a href="../Basics/Serial Bluetooth.html" style="padding-left:20px" class="pure-menu-link">Serial Bluetooth</a>
                            </li><li class="">
                                <a href="../Basics/Communication Protocols.html" style="padding-left:20px" class="pure-menu-link">Communication Protocols</a>
                            </li><li class="">
                                <a href="../Basics/MicroPython Installation.html" style="padding-left:20px" class="pure-menu-link">MicroPython Installation</a>
                            </li>
                        </ul>
                    </ul>
                    <ul class="pure-menu-list">
                        <label for="drop1" class="toggle" style="padding-left: 10px;">Easy projects</label>
                        <input type="checkbox" id="drop1" />
                        <ul class="pure-menu-item menu">
                            <li class="">
                                <a href="Bluetooth Keyboard.html" style="padding-left:20px" class="pure-menu-link">Bluetooth Keyboard</a>
                            </li>
                            <li class=""><a style="padding-left:20px" href="Cloud Server.html" class="pure-menu-link">Cloud Server</a>
                            </li>
                            <li class=""><a style="padding-left:20px" href="Deep Sleep.html" class="pure-menu-link">Deep Sleep</a>
                            </li>
                            <li class="">
                                <a href="Dual Core Processing.html" style="padding-left:20px" class="pure-menu-link">Dual Core Processing</a>
                            </li>
                            <li class="">
                                <a href="LDR sensor.html" style="padding-left:20px" class="pure-menu-link">LDR sensor</a>
                            </li>
                            <li class="">
                                <a href="LED Web Server.html" style="padding-left:20px" class="pure-menu-link">LED Web Server</a>
                            </li>
                            <li class="">
                                <a href="NeoPixel LED Control.html" style="padding-left:20px" class="pure-menu-link">NeoPixel LED Control</a>
                            </li><li class="">
                                <a href="OLED display.html" style="padding-left:20px" class="pure-menu-link">OLED display</a>
                            </li>
                            
                            <li class="">
                                <a href="Realtime clock.html" style="padding-left:20px" class="pure-menu-link">Realtime clock</a>
                            </li>
                            
                            <li class="">
                                <a href="Web Server Game.html" style="padding-left:20px" class="pure-menu-link">Web Server Game</a>
                            </li>

                            
                        </ul>
                        <label for="drop2" class="toggle" style="padding-left: 10px;">Moderate or Difficult projects</label>
                        <input type="checkbox" id="drop2" />
                        <ul class="pure-menu-item menu">

                            <li class=""><a style="padding-left:20px" href="../Moderate/BLE Control.html" class="pure-menu-link">BLE Control</a>
                            </li>
                            <li class="">
                                <a href="../Moderate/Email Alert.html" style="padding-left:20px" class="pure-menu-link">Email Alert</a>
                            </li>
                           
                            <li class=""><a href="../Moderate/FlappyBird.html" style="padding-left:20px"
                                class="pure-menu-link">FlappyBird</a></li>
                           
                            <li class=""><a style="padding-left:20px" href="../Moderate/Instagram Follower Counter.html" class="pure-menu-link">Instagram Follower Counter</a>
                            </li>
                            <li class=""><a style="padding-left:20px" href="../Moderate/Joystick.html" class="pure-menu-link">Joystick</a>
                            </li>
                            <li class=""><a style="padding-left:20px" href="../Moderate/Pulse Oximeter.html" class="pure-menu-link">Pulse Oximeter</a>
                            </li>
                           
                                
                                <li class=""><a style="padding-left:20px" href="../Moderate/Telegram-Motion detection.html" class="pure-menu-link">Telegram-Motion detection</a>
                                </li>
                                <li class=""><a style="padding-left:20px" href="../Moderate/Telegram-RGB.html" class="pure-menu-link">Telegram-RGB</a>
                                </li>
                        </ul>

                    </ul>
                    </li>

                </ul>
            </div>
        </div>

        <div id="main">

            <div class="header">
                <h1 id="dual-core-processing-in-esp32">Dual Core Processing in ESP32</h1>

            </div>

            <div class="content">

<h2 id="description">Description</h2>
<ul>
<li>Using dual core feature of ESP32 to run 2 different tasks parallely on ESP32 (Parallel processing).</li>
<li>With the help of dual core feature, blinking 2 LED&#39;s at two different blinking rates on ESP32<h2 id="concept">Concept</h2>
</li>
<li>The ESP32 comes with 2 Xtensa 32-bit LX6 microprocessors: core 0 and core 1 (Dual core). </li>
<li>When we run code on Arduino IDE, by default, it runs on core 1.</li>
<li>The ESP32 comes with 2 Xtensa 32-bit LX6 microprocessors along with 2 cores, <strong>Core 0</strong> and <strong>Core 1</strong>.</li>
<li>The Arduino IDE supports FreeRTOS for the ESP32, which is a Real Time Operating system (RTOS). This allows us to handle several tasks in parallel that run independently.</li>
<li>Tasks are pieces of code that execute something. For example, it can be blinking an LED, making a network request, measuring sensor readings, publishing sensor readings, etc</li>
<li>To assign specific parts of code to a specific core, you need to create tasks. When creating a task you can chose in which core it will run, as well as its priority. Priority values start at 0, in which 0 is the lowest priority. The processor will run the tasks with higher priority first.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p><strong>None</strong></p>
<h2 id="components">Components</h2>
<ul>
<li>ESP32 CustomDev Board</li>
<li>2 LED&#39;s</li>
<li>2 x 300 ohm resistor</li>
<li>Breadboard</li>
<li>Jumper Wires</li>
</ul>

<h2 id="schematic">Schematic</h2>
<img src="https://github.com/CFI-Electronics-Club/Dev-Board-Documentation/blob/main/Easy%20Projects/Images/DualCoreProcessing.png?raw=true" alt="image"></li>
<h2 id="code">Code</h2>
<pre><code><span class="hljs-comment">// The below code blinks 2 LED on different cores (Parallel blinking at different blinking rates)</span>
TaskHandle_t Task1; <span class="hljs-comment">// Initializing the tasks</span>
TaskHandle_t Task2;

<span class="hljs-comment">// LED pins</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> led1 = <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> led2 = <span class="hljs-number">4</span>;

<span class="hljs-keyword">void</span> <span class="hljs-built_in">setup</span>() {
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">begin</span>(<span class="hljs-number">115200</span>); 
  <span class="hljs-built_in">pinMode</span>(led1, <span class="hljs-literal">OUTPUT</span>);
  <span class="hljs-built_in">pinMode</span>(led2, <span class="hljs-literal">OUTPUT</span>);

  <span class="hljs-comment">//create a task that will be executed in the Task1code() function, with priority 1 and executed on core 0</span>
  xTaskCreatePinnedToCore(
                    Task1code,   <span class="hljs-comment">/* Task function. */</span>
                    <span class="hljs-string">"Task1"</span>,     <span class="hljs-comment">/* name of task. */</span>
                    <span class="hljs-number">10000</span>,       <span class="hljs-comment">/* Stack size of task */</span>
                    NULL,        <span class="hljs-comment">/* parameter of the task */</span>
                    <span class="hljs-number">1</span>,           <span class="hljs-comment">/* priority of the task */</span>
                    &amp;Task1,      <span class="hljs-comment">/* Task handle to keep track of created task */</span>
                    <span class="hljs-number">0</span>);          <span class="hljs-comment">/* pin task to core 0 */</span>                  
  <span class="hljs-built_in">delay</span>(<span class="hljs-number">500</span>); 

  <span class="hljs-comment">//create a task that will be executed in the Task2code() function, with priority 1 and executed on core 1</span>
  xTaskCreatePinnedToCore(
                    Task2code,   <span class="hljs-comment">/* Task function. */</span>
                    <span class="hljs-string">"Task2"</span>,     <span class="hljs-comment">/* name of task. */</span>
                    <span class="hljs-number">10000</span>,       <span class="hljs-comment">/* Stack size of task */</span>
                    NULL,        <span class="hljs-comment">/* parameter of the task */</span>
                    <span class="hljs-number">1</span>,           <span class="hljs-comment">/* priority of the task */</span>
                    &amp;Task2,      <span class="hljs-comment">/* Task handle to keep track of created task */</span>
                    <span class="hljs-number">1</span>);          <span class="hljs-comment">/* pin task to core 1 */</span>
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">500</span>); 
}

<span class="hljs-comment">//Task1code: blinks an LED every 1000 ms</span>
<span class="hljs-keyword">void</span> Task1code( <span class="hljs-keyword">void</span> * pvParameters ){
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span>(<span class="hljs-string">"Task1 running on core "</span>);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(xPortGetCoreID());

  <span class="hljs-built_in">for</span>(;;){
    <span class="hljs-built_in">digitalWrite</span>(led1, <span class="hljs-literal">HIGH</span>);
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>);
    <span class="hljs-built_in">digitalWrite</span>(led1, <span class="hljs-literal">LOW</span>);
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>);
  } 
}

<span class="hljs-comment">//Task2code: blinks an LED every 700 ms</span>
<span class="hljs-keyword">void</span> Task2code( <span class="hljs-keyword">void</span> * pvParameters ){
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">print</span>(<span class="hljs-string">"Task2 running on core "</span>);
  <span class="hljs-built_in">Serial</span>.<span class="hljs-built_in">println</span>(xPortGetCoreID());

  <span class="hljs-built_in">for</span>(;;){
    <span class="hljs-built_in">digitalWrite</span>(led2, <span class="hljs-literal">HIGH</span>);
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">700</span>);
    <span class="hljs-built_in">digitalWrite</span>(led2, <span class="hljs-literal">LOW</span>);
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">700</span>);
  }
}

<span class="hljs-keyword">void</span> <span class="hljs-built_in">loop</span>() {

}
</code></pre><h2 id="follow-up-problem-statement">Follow up Problem Statement</h2>
<ul>
<li>Figure out how is the above code different from coding the blinking of 2 LED&#39;s in series at different blinking rates. You can even code the above without using dual core (Not true in general for any code). </li>
<li>Blink 2 LED&#39;s at different blinking rates <strong>without using Dual Core (RTOS)</strong>
PS - You can code in series in a single core. (Hint - Avoid using delay() function. Try searching for and using <strong>millis()</strong> function)<h2 id="reference">Reference</h2>
</li>
<li>Watch this <a href="https://youtu.be/k_D_Qu0cgu8">video</a> on <strong>Dual Core Processing in ESP32</strong> by <strong>Andreas Spiess</strong> to gain a broader insight.</li>
</ul>


            </div>
        </div>
    </div>
    <script src="../articles.js"></script>

    <script src="../ui.js"></script>

</body>

</html>